<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrailGuardian - Trail Safety Reporting</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    
    <style>
        body { margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        #map { height: 100vh; width: 100%; }
        .sidebar {
            position: absolute; top: 10px; right: 10px; width: 350px; 
            background: white; padding: 20px; border-radius: 10px; 
            box-shadow: 0 0 10px rgba(0,0,0,0.2); z-index: 1000; 
            max-height: 95vh; overflow-y: auto;
        }
        .report-marker { font-size: 20px; }
        .danger-marker { color: #dc3545; }
        .water-marker { color: #0d6efd; }
        .animal-marker { color: #fd7e14; }
        .rest-area-marker { color: #198754; }
        .other-marker { color: #6c757d; }
        .status-indicator {
            position: absolute; top: 10px; left: 10px; z-index: 1000;
            padding: 5px 10px; border-radius: 5px; font-size: 12px;
            background: #f8d7da; color: #721c24;
        }
    </style>
</head>
<body>
    <!-- Backend Status Indicator -->
    <div class="status-indicator">
        ‚ö†Ô∏è Backend: Not connected (Java Spring Boot)
    </div>
    
    <!-- Map Container -->
    <div id="map"></div>
    
    <!-- Sidebar -->
    <div class="sidebar">
        <h3 class="text-success">üèîÔ∏è TrailGuardian</h3>
        <p class="text-muted">Report trail hazards and helpful spots</p>
        
        <!-- Report Form -->
        <form id="reportForm">
            <div class="mb-3">
                <label class="form-label">Title *</label>
                <input type="text" class="form-control" id="title" required placeholder="e.g., Fallen Tree, Clean Water">
            </div>
            
            <div class="mb-3">
                <label class="form-label">Description</label>
                <textarea class="form-control" id="description" rows="3" placeholder="Provide more details..."></textarea>
            </div>
            
            <div class="mb-3">
                <label class="form-label">Report Type *</label>
                <select class="form-select" id="reportType" required>
                    <option value="">Select type...</option>
                    <option value="DANGER">‚ö†Ô∏è Danger/Hazard</option>
                    <option value="WATER">üíß Water Source</option>
                    <option value="ANIMAL">üêª Animal Sighting</option>
                    <option value="REST_AREA">üõå Rest Area</option>
                    <option value="OTHER">üìå Other</option>
                </select>
            </div>
            
            <div class="mb-3">
                <label class="form-label">Your Name (optional)</label>
                <input type="text" class="form-control" id="submittedBy" placeholder="Anonymous">
            </div>
            
            <div class="mb-3">
                <label class="form-label">Location</label>
                <div class="input-group">
                    <input type="number" class="form-control" id="latitude" placeholder="Latitude" step="any" readonly>
                    <input type="number" class="form-control" id="longitude" placeholder="Longitude" step="any" readonly>
                </div>
                <small class="text-muted">Click on map to set location</small>
            </div>
            
            <button type="submit" class="btn btn-success w-100">
                Submit Report
            </button>
        </form>
        
        <hr>
        
        <!-- Reports List -->
        <div id="reportsList">
            <h5>Recent Reports</h5>
            <div id="reportsContainer">
                <div class="card mb-2">
                    <div class="card-body p-3">
                        <h6 class="card-title">‚ö†Ô∏è Fallen Tree</h6>
                        <p class="card-text small">Large tree blocking main trail path</p>
                        <small class="text-muted">hiker123 ‚Ä¢ Just now</small>
                    </div>
                </div>
                <div class="card mb-2">
                    <div class="card-body p-3">
                        <h6 class="card-title">üíß Clean Water Source</h6>
                        <p class="card-text small">Fresh spring water available here</p>
                        <small class="text-muted">trail_angel ‚Ä¢ 2 hours ago</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap & Leaflet JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    
    <script>
        // Global variables
        let map;
        let markers = [];
        let selectedLatLng = null;

        // Sample data - will work even without backend
        let reports = [
            {
                id: 1,
                title: "Fallen Tree",
                description: "Large tree blocking main trail path",
                reportType: "DANGER",
                latitude: 40.7128,
                longitude: -74.0060,
                submittedBy: "hiker123",
                createdAt: new Date()
            },
            {
                id: 2, 
                title: "Clean Water Source",
                description: "Fresh spring water available here",
                reportType: "WATER",
                latitude: 40.7135,
                longitude: -74.0055,
                submittedBy: "trail_angel",
                createdAt: new Date()
            }
        ];

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeMap();
            displayReportsOnMap();
            setupEventListeners();
        });

        // Initialize Leaflet map
        function initializeMap() {
            // Create map centered on a default location (New York)
            map = L.map('map').setView([40.7128, -74.0060], 13);
            
            // Add OpenStreetMap tiles
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(map);
            
            // Add click event to map
            map.on('click', function(e) {
                setSelectedLocation(e.latlng.lat, e.latlng.lng);
                addTemporaryMarker(e.latlng);
            });

            // Display sample markers
            displayReportsOnMap();
        }

        function setSelectedLocation(lat, lng) {
            document.getElementById('latitude').value = lat.toFixed(6);
            document.getElementById('longitude').value = lng.toFixed(6);
            selectedLatLng = { lat: lat, lng: lng };
        }

        function addTemporaryMarker(latlng) {
            // Remove existing temporary marker
            markers.forEach(marker => {
                if (marker.isTemporary) {
                    map.removeLayer(marker);
                }
            });
            
            // Add new temporary marker
            const tempMarker = L.marker(latlng, {
                icon: L.divIcon({
                    className: 'report-marker',
                    html: 'üìç',
                    iconSize: [30, 30]
                })
            }).addTo(map);
            
            tempMarker.bindPopup('<strong>Selected Location</strong><br>Click submit to report here');
            tempMarker.isTemporary = true;
            markers.push(tempMarker);
            
            // Open popup automatically
            tempMarker.openPopup();
        }

        function setupEventListeners() {
            const form = document.getElementById('reportForm');
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                if (!selectedLatLng) {
                    alert('Please click on the map to select a location first!');
                    return;
                }

                const newReport = {
                    id: reports.length + 1,
                    title: document.getElementById('title').value,
                    description: document.getElementById('description').value,
                    reportType: document.getElementById('reportType').value,
                    latitude: selectedLatLng.lat,
                    longitude: selectedLatLng.lng,
                    submittedBy: document.getElementById('submittedBy').value || 'Anonymous',
                    createdAt: new Date()
                };

                reports.unshift(newReport); // Add to beginning of array
                
                alert('‚úÖ Report submitted successfully!');
                document.getElementById('reportForm').reset();
                selectedLatLng = null;
                
                // Remove temporary marker
                markers.forEach(marker => {
                    if (marker.isTemporary) {
                        map.removeLayer(marker);
                    }
                });
                markers = markers.filter(marker => !marker.isTemporary);
                
                // Refresh display
                displayReportsOnMap();
                displayReportsInList();
            });
        }

        function displayReportsOnMap() {
            // Clear existing markers (except temporary ones)
            markers.forEach(marker => {
                if (!marker.isTemporary) {
                    map.removeLayer(marker);
                }
            });
            markers = markers.filter(marker => marker.isTemporary);
            
            // Add markers for each report
            reports.forEach(report => {
                const marker = L.marker([report.latitude, report.longitude], {
                    icon: L.divIcon({
                        className: 'report-marker',
                        html: getMarkerIcon(report.reportType),
                        iconSize: [30, 30]
                    })
                }).addTo(map);
                
                marker.bindPopup(`
                    <strong>${report.title}</strong><br>
                    Type: ${report.reportType}<br>
                    ${report.description ? `Desc: ${report.description}<br>` : ''}
                    Submitted by: ${report.submittedBy}<br>
                    <small>${report.createdAt.toLocaleDateString()}</small>
                `);
                
                marker.isTemporary = false;
                markers.push(marker);
            });
        }

        function displayReportsInList() {
            const container = document.getElementById('reportsContainer');
            container.innerHTML = '';
            
            reports.slice(0, 5).forEach(report => {
                const reportElement = document.createElement('div');
                reportElement.className = 'card mb-2';
                reportElement.innerHTML = `
                    <div class="card-body p-3">
                        <h6 class="card-title">${getMarkerIcon(report.reportType)} ${report.title}</h6>
                        <p class="card-text small">${report.description || 'No description'}</p>
                        <div class="d-flex justify-content-between">
                            <small class="text-muted">${report.submittedBy}</small>
                            <small class="text-muted">${report.createdAt.toLocaleDateString()}</small>
                        </div>
                    </div>
                `;
                container.appendChild(reportElement);
            });
        }

        function getMarkerIcon(reportType) {
            const icons = {
                'DANGER': '‚ö†Ô∏è',
                'WATER': 'üíß',
                'ANIMAL': 'üêª',
                'REST_AREA': 'üõå',
                'OTHER': 'üìå'
            };
            return icons[reportType] || 'üìå';
        }

        // Initial display of reports in list
        displayReportsInList();
    </script>
</body>
</html>